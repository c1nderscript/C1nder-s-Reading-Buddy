# Warp Agents Configuration
execution_mode: strict
policies:
  - Warp Execution Policy v1
description: |
  This file enables Warp agents to operate in strict mode for this repository.
  See RULE ZV09g2iKm5XkMBmMF3v4SV for policy details.

# agents.md â€“ Warp & Codex Integration Spec

## System Overview

This multi-agent pipeline ingests a knowledge base of technical documents, converts them to markdown, splits and randomizes content, and generates Kindle-ready EPUB or MOBI files. It supports PDFs, DOCX, MD/MDX, and TXT files. Agents track ingestion history, orchestrate transformations, and ensure reproducibility through logs and deterministic processing.

---

## Agent Registry

### Warp Agents

#### `IngestCoordinator`

**Role**: Orchestrator
**Function**: Coordinates file discovery and tracks processed state. Delegates conversion jobs.
**State**: Reads/writes `Logs/processed_files.log`
**Interface**: CLI bash wrapper `ingest_and_convert.sh`
**Tools**: Python (ingest\_and\_convert.py), Pandoc

#### `MarkdownConverter`

**Role**: Worker
**Function**: Converts source files to markdown. Handles `.md`, `.mdx`, `.txt`, `.pdf`, and `.docx`.
**Trigger**: Called per unprocessed file
**Directive**:

```markdown
!if ext:pdf|docx|txt => `pandoc $SRC -o $DEST`
```

#### `Splitter`

**Role**: Worker
**Function**: Splits long markdown files into \~5000-character chunks.
**Trigger**: `split_markdown.sh`
**Output**: Files in `Split/`

#### `Shuffler`

**Role**: Worker
**Function**: Randomizes chunk order for spaced learning effect.
**Trigger**: `shuffle_split_files.sh`

#### `KindleFormatter`

**Role**: Specialist
**Function**: Converts markdown chunks to Kindle format (EPUB/MOBI).
**Tool**: `convert_to_kindle.sh`, `kindlegen` (optional)
**Directive**:

```markdown
!if tool:kindlegen => `kindlegen $INPUT -o $OUTPUT`
!else => `pandoc $INPUT -o $OUTPUT.epub`
```

### Codex Agents

#### `SetupInstaller`

**Role**: Guardian
**Function**: Ensures required tools are available and no insecure scripts are executed.
**Trigger**: Pre-run setup
**Security**:

```bash
pip-audit requirements.txt
!safe_docker_exec image:ubuntu cmd:"make test"
```

#### `IngestionMonitor`

**Role**: Observer
**Function**: Validates ingestion progress by scanning logs and summary files.
**Data**: `Logs/processed_files.log`, `ingested.md`

---

## Agentic Workflow Protocol

```markdown
## Reasoning: "Ensure no file is reprocessed; convert all readable formats to .md"
- Tools:
  - !if ext:pdf|docx => `pandoc $SRC -o $DEST`
  - !if ext:md|mdx|txt => `cp $SRC $DEST`
- State: `Logs/processed_files.log`
- Fallbacks: retry conversion up to 3x on error
```

---

## State Management

```markdown
- format: json://Logs/state.agent
- fields:
  total_converted: int
  last_run: timestamp
  failed_files: list[str]
```

---

## Cross-Repo Dependencies

*No external repositories required.*

---

## Non-Code Assets

```markdown
- diagram_parser: !tool glama-chat @version:2.3
  input: assets/*.drawio
  output: docs/diagrams.md
```

---

## Change History

* `v0.1`: Initial spec integrating ingest/convert/split/shuffle/publish flow.
* `v0.2`: Added Codex security layer and state tracking.
